# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

## ğŸ¯ å­¦ç¿’ç›®æ¨™

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å®‰å…¨ãªå–ã‚Šæ‰±ã„æ–¹æ³•ã‚’ç†è§£ã™ã‚‹
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã®ä»•çµ„ã¿ã‚’çŸ¥ã‚‹
- å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¡ä»¶ã¨æ¤œè¨¼æ–¹æ³•ã‚’å­¦ã¶
- ã‚½ãƒ«ãƒˆã¨ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã«ã¤ã„ã¦ç†è§£ã™ã‚‹
- ãƒã‚±ãƒƒãƒˆãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã§ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å‡¦ç†ã‚’åˆ†æã™ã‚‹

## ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦æ€§

### ğŸ˜± ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é–¢é€£ã®è„…å¨

```mermaid
mindmap
  root)ğŸš¨ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è„…å¨(
    ğŸ”“ å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
      æ¨æ¸¬ã—ã‚„ã™ã„
      è¾æ›¸æ”»æ’ƒ
      ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒ
    ğŸ”„ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä½¿ã„å›ã—
      1ã¤æ¼ã‚Œã‚‹ã¨å…¨ã¦å±é™º
      ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¹—ã£å–ã‚Š
      è¢«å®³æ‹¡å¤§
    ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ¼æ´©
      å¹³æ–‡ä¿å­˜ã®å±é™º
      ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æµå‡º
      å†…éƒ¨çŠ¯è¡Œãƒªã‚¹ã‚¯
    ğŸ£ ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒ
      å½ã‚µã‚¤ãƒˆã§ã®å…¥åŠ›
      ãƒ¡ãƒ¼ãƒ«ãƒ»SMSè©æ¬º
      ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
```

### ğŸ“ˆ å®Ÿéš›ã®è¢«å®³çµ±è¨ˆ

- **2023å¹´**: ä¸–ç•Œã§ 33å„„ä»¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¼æ´©
- **æœ€ã‚‚ä½¿ã‚ã‚Œã‚‹å±é™ºãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: "123456", "password", "qwerty"
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä½¿ã„å›ã—ç‡**: ç´„65%ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¤‡æ•°ã‚µã‚¤ãƒˆã§ä½¿ç”¨

## ğŸ§‚ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã¨ã‚½ãƒ«ãƒˆ

### ğŸ¤” ãªãœãƒãƒƒã‚·ãƒ¥åŒ–ãŒå¿…è¦ãªã®ã‹

```typescript
// âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
const users = [
  { email: "user1@example.com", password: "password123" },  // å¹³æ–‡ä¿å­˜ï¼
  { email: "user2@example.com", password: "qwerty" }        // å±é™ºï¼
];

// ã‚‚ã—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ¼æ´©ã—ãŸã‚‰...
// â†’ ã™ã¹ã¦ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸¸è¦‹ãˆ ğŸ˜±
```

```typescript
// âœ… æ­£ã—ã„ä¾‹: ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜
const users = [
  { 
    email: "user1@example.com", 
    password_hash: "$2b$10$rO0H0.7.6.4.2.8.Kk.vwOe7G4.8.Y.2.6.4.K"  // ãƒãƒƒã‚·ãƒ¥åŒ–æ¸ˆã¿
  },
  { 
    email: "user2@example.com", 
    password_hash: "$2b$10$aB1H9.3.7.2.9.1.Jm.xQr8F2.1.9.7.3.2.L"  // ãƒãƒƒã‚·ãƒ¥åŒ–æ¸ˆã¿
  }
];

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ¼æ´©ã—ã¦ã‚‚...
// â†’ ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰ã‚‚ã¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å…ƒã™ã‚‹ã“ã¨ã¯å›°é›£ âœ…
```

### ğŸ”„ ãƒãƒƒã‚·ãƒ¥åŒ–ã®æµã‚Œ

```mermaid
flowchart LR
    A[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> B[ğŸ”‘ password123]
    B --> C[ğŸ§‚ + ãƒ©ãƒ³ãƒ€ãƒ ã‚½ãƒ«ãƒˆ]
    C --> D[ğŸ”„ ãƒãƒƒã‚·ãƒ¥é–¢æ•°]
    D --> E[ğŸ’¾ ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ä¿å­˜]
    
    F[ğŸ´â€â˜ ï¸ æ”»æ’ƒè€…] --> G[ğŸ’¾ ãƒãƒƒã‚·ãƒ¥å€¤ã‚’å–å¾—]
    G --> H{ğŸ”„ é€†ç®—å¯èƒ½ï¼Ÿ}
    H -->|No| I[âŒ å…ƒã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸æ˜]
    
    style E fill:#c8e6c9
    style I fill:#ffcdd2
```

### ğŸ§‚ ã‚½ãƒ«ãƒˆï¼ˆSaltï¼‰ã®é‡è¦æ€§

#### ã‚½ãƒ«ãƒˆãªã—ã®å ´åˆï¼ˆå±é™ºï¼‰

```typescript
// âŒ ã‚½ãƒ«ãƒˆãªã—ãƒãƒƒã‚·ãƒ¥åŒ–
const password1 = "password123";
const password2 = "password123";

const hash1 = sha256(password1); // â†’ a1b2c3d4e5f6...
const hash2 = sha256(password2); // â†’ a1b2c3d4e5f6... (åŒã˜ãƒãƒƒã‚·ãƒ¥ï¼)

// å•é¡Œ:
// 1. åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯åŒã˜ãƒãƒƒã‚·ãƒ¥ã«ãªã‚‹
// 2. ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒãŒå¯èƒ½
// 3. ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã§æ¨æ¸¬ã•ã‚Œã‚‹
```

#### ã‚½ãƒ«ãƒˆã‚ã‚Šã®å ´åˆï¼ˆå®‰å…¨ï¼‰

```typescript
// âœ… ã‚½ãƒ«ãƒˆä»˜ããƒãƒƒã‚·ãƒ¥åŒ–
const password1 = "password123";
const password2 = "password123";
const salt1 = generateRandomSalt(); // â†’ "x9k2m5p8"
const salt2 = generateRandomSalt(); // â†’ "f4j7q1n3"

const hash1 = bcrypt(password1 + salt1); // â†’ $2b$10$x9k2m5p8...
const hash2 = bcrypt(password2 + salt2); // â†’ $2b$10$f4j7q1n3... (ç•°ãªã‚‹ãƒãƒƒã‚·ãƒ¥ï¼)

// åˆ©ç‚¹:
// 1. åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ç•°ãªã‚‹ãƒãƒƒã‚·ãƒ¥
// 2. ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã‚’ç„¡åŠ¹åŒ–
// 3. è¾æ›¸æ”»æ’ƒã®åŠ¹ç‡ã‚’å¤§å¹…ã«ä¸‹ã’ã‚‹
```

## ğŸ” ãƒã‚±ãƒƒãƒˆãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã§ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å‡¦ç†

### Supabase ã§ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†

ç§ãŸã¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ **Supabase** ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å‡¦ç†ã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ï¼š

```typescript
// app/features/auth/lib/auth-context.tsx ã‚ˆã‚Š
const signUp = async (email: string, password: string) => {
  try {
    // å…¥åŠ›æ¤œè¨¼
    if (!email || !password) {
      return { error: { message: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™" } };
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯
    if (password.length < 8) {
      return {
        error: { message: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™" },
      };
    }

    // Supabase ã«ç™»éŒ²ï¼ˆSupabase ãŒãƒãƒƒã‚·ãƒ¥åŒ–ã‚’å‡¦ç†ï¼‰
    const { error } = await supabase.auth.signUp({
      email: email.toLowerCase().trim(),
      password,
    });

    if (error) {
      console.error("Sign up failed:", error.message);
    }

    return { error };
  } catch (error) {
    console.error("Unexpected sign up error:", error);
    return { error: { message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ" } };
  }
};
```

### ğŸ›¡ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®è¿½åŠ æ¤œè¨¼

```typescript
// app/lib/security-utils.ts ã‚ˆã‚Š
export const validators = {
  password: (
    password: string,
  ): { valid: boolean; score: number; feedback: string[] } => {
    const feedback: string[] = [];
    let score = 0;

    if (password.length >= 8) score += 1;
    else feedback.push("8æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    if (/[a-z]/.test(password)) score += 1;
    else feedback.push("å°æ–‡å­—ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    if (/[A-Z]/.test(password)) score += 1;
    else feedback.push("å¤§æ–‡å­—ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    if (/\d/.test(password)) score += 1;
    else feedback.push("æ•°å­—ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score += 1;
    else feedback.push("ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™");

    return {
      valid: score >= 3,
      score,
      feedback,
    };
  },
};
```

## ğŸ’ª å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¡ä»¶

### ğŸ“ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã®åŸºæº–

```mermaid
graph TD
    A[ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯] --> B{æ–‡å­—æ•°}
    B -->|8æ–‡å­—æœªæº€| C[âŒ å¼±ã„]
    B -->|8æ–‡å­—ä»¥ä¸Š| D{æ–‡å­—ç¨®é¡}
    
    D --> E[å°æ–‡å­— a-z]
    D --> F[å¤§æ–‡å­— A-Z]
    D --> G[æ•°å­— 0-9]
    D --> H[ç‰¹æ®Šæ–‡å­— !@#$%...]
    
    E --> I{å«ã¾ã‚Œã‚‹ç¨®é¡æ•°}
    F --> I
    G --> I
    H --> I
    
    I -->|1-2ç¨®é¡| J[âš ï¸ æ™®é€š]
    I -->|3ç¨®é¡| K[âœ… è‰¯ã„]
    I -->|4ç¨®é¡| L[ğŸ”¥ å„ªç§€]
    
    style C fill:#ffcdd2
    style J fill:#fff3e0
    style K fill:#c8e6c9
    style L fill:#a5d6a7
```

### ğŸ¯ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã‚¹ã‚³ã‚¢

```typescript
// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã‚’æ•°å€¤ã§è©•ä¾¡
function calculatePasswordStrength(password: string): {
  score: number;
  level: string;
  suggestions: string[];
} {
  let score = 0;
  const suggestions: string[] = [];

  // é•·ã•ã«ã‚ˆã‚‹å¾—ç‚¹
  if (password.length >= 8) score += 2;
  else if (password.length >= 6) score += 1;
  else suggestions.push("ã‚‚ã£ã¨é•·ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã—ã¦ãã ã•ã„");

  // æ–‡å­—ç¨®é¡ã«ã‚ˆã‚‹å¾—ç‚¹
  if (/[a-z]/.test(password)) score += 1;
  else suggestions.push("å°æ–‡å­—ã‚’å«ã‚ã¦ãã ã•ã„");

  if (/[A-Z]/.test(password)) score += 1;
  else suggestions.push("å¤§æ–‡å­—ã‚’å«ã‚ã¦ãã ã•ã„");

  if (/\d/.test(password)) score += 1;
  else suggestions.push("æ•°å­—ã‚’å«ã‚ã¦ãã ã•ã„");

  if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score += 1;
  else suggestions.push("ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™");

  // è¤‡é›‘æ€§ã«ã‚ˆã‚‹å¾—ç‚¹
  if (password.length >= 12) score += 1;
  if (/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/.test(password)) score += 1;

  // ãƒ¬ãƒ™ãƒ«åˆ¤å®š
  let level: string;
  if (score >= 7) level = "éå¸¸ã«å¼·ã„";
  else if (score >= 5) level = "å¼·ã„";
  else if (score >= 3) level = "æ™®é€š";
  else level = "å¼±ã„";

  return { score, level, suggestions };
}

// ä½¿ç”¨ä¾‹
const result = calculatePasswordStrength("MySecure123!");
console.log(result);
// {
//   score: 6,
//   level: "å¼·ã„",
//   suggestions: ["ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™"]
// }
```

## ğŸš« ã‚ˆãã‚ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å•é¡Œ

### âŒ é¿ã‘ã‚‹ã¹ããƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
const commonBadPasswords = [
  // å˜ç´”ã™ãã‚‹
  "123456", "password", "qwerty", "abc123",
  
  // å€‹äººæƒ…å ±ãƒ™ãƒ¼ã‚¹
  "tanaka1980", "tokyo123", "birthday",
  
  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
  "asdfgh", "123qwe", "qwerty123",
  
  // è¾æ›¸ã«ã‚ã‚‹å˜èª
  "welcome", "admin", "user", "guest"
];

function isCommonPassword(password: string): boolean {
  return commonBadPasswords.includes(password.toLowerCase());
}
```

### ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¨æ¸¬æ”»æ’ƒã®ä¾‹

```mermaid
sequenceDiagram
    participant A as ğŸ´â€â˜ ï¸ æ”»æ’ƒè€…
    participant W as ğŸŒ Web ã‚¢ãƒ—ãƒª
    participant R as ğŸ›¡ï¸ ãƒ¬ãƒ¼ãƒˆåˆ¶é™
    participant DB as ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    Note over A,DB: è¾æ›¸æ”»æ’ƒ
    loop ã‚ˆãã‚ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
        A->>W: login(email, "password")
        W->>R: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
        alt åˆ¶é™å†…
            W->>DB: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç…§åˆ
            DB-->>W: èªè¨¼å¤±æ•—
            W-->>A: ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—
        else åˆ¶é™è¶…é
            R-->>W: ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
            W-->>A: "ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„"
        end
    end
```

## ğŸ›¡ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ”»æ’ƒå¯¾ç­–

### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…

```typescript
// app/lib/security-utils.ts ã‚ˆã‚Š
class RateLimit {
  private attempts: Map<string, number[]> = new Map();
  private maxAttempts: number;
  private windowMs: number;

  constructor(maxAttempts: number = 5, windowMs: number = 15 * 60 * 1000) {
    this.maxAttempts = maxAttempts;
    this.windowMs = windowMs;
  }

  isAllowed(key: string): boolean {
    const now = Date.now();
    const attempts = this.attempts.get(key) || [];

    // å¤ã„è©¦è¡Œã‚’å‰Šé™¤
    const recentAttempts = attempts.filter(
      (time) => now - time < this.windowMs,
    );

    if (recentAttempts.length >= this.maxAttempts) {
      return false;
    }

    recentAttempts.push(now);
    this.attempts.set(key, recentAttempts);

    return true;
  }

  getRemainingTime(key: string): number {
    const attempts = this.attempts.get(key) || [];
    if (attempts.length === 0) return 0;

    const oldestAttempt = Math.min(...attempts);
    const timeToReset = this.windowMs - (Date.now() - oldestAttempt);

    return Math.max(0, timeToReset);
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
export const authRateLimit = new RateLimit(5, 15 * 60 * 1000); // 15åˆ†é–“ã§5å›ã¾ã§
```

### 2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ

```typescript
// ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—æ™‚ã®å‡¦ç†
async function handleLoginAttempt(email: string, password: string) {
  const clientIP = getClientIP();
  const identifier = `${email}:${clientIP}`;

  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
  if (!authRateLimit.isAllowed(identifier)) {
    const remainingTime = authRateLimit.getRemainingTime(identifier);
    return {
      error: {
        message: `ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚${Math.ceil(remainingTime / 1000)}ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚`
      }
    };
  }

  // èªè¨¼å‡¦ç†
  const result = await supabase.auth.signInWithPassword({ email, password });
  
  if (result.error) {
    // å¤±æ•—ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
    console.warn(`Login failed for ${email} from ${clientIP}`);
  }

  return result;
}
```

### 3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã®å¯è¦–åŒ–

```typescript
// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦è¡¨ç¤º
function PasswordStrengthIndicator({ password }: { password: string }) {
  const strength = calculatePasswordStrength(password);
  
  const getColor = (level: string) => {
    switch (level) {
      case "éå¸¸ã«å¼·ã„": return "bg-green-500";
      case "å¼·ã„": return "bg-blue-500";
      case "æ™®é€š": return "bg-yellow-500";
      case "å¼±ã„": return "bg-red-500";
      default: return "bg-gray-300";
    }
  };

  return (
    <div className="mt-2">
      <div className="flex items-center space-x-2">
        <div className="flex-1 bg-gray-200 rounded-full h-2">
          <div 
            className={`h-2 rounded-full transition-all duration-300 ${getColor(strength.level)}`}
            style={{ width: `${(strength.score / 8) * 100}%` }}
          />
        </div>
        <span className="text-sm font-medium">{strength.level}</span>
      </div>
      
      {strength.suggestions.length > 0 && (
        <ul className="mt-1 text-xs text-gray-600">
          {strength.suggestions.map((suggestion, index) => (
            <li key={index}>â€¢ {suggestion}</li>
          ))}
        </ul>
      )}
    </div>
  );
}
```

## ğŸ”„ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½

### å®‰å…¨ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant W as ğŸŒ Web ã‚¢ãƒ—ãƒª
    participant E as ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼
    participant DB as ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    Note over U,DB: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆè¦æ±‚
    U->>W: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸ"ã‚’ã‚¯ãƒªãƒƒã‚¯
    U->>W: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
    W->>DB: ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèª
    DB-->>W: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    W->>W: ä¸€æ™‚çš„ãªãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    W->>DB: ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ï¼ˆæœ‰åŠ¹æœŸé™ä»˜ãï¼‰
    W->>E: ãƒªã‚»ãƒƒãƒˆURLä»˜ããƒ¡ãƒ¼ãƒ«é€ä¿¡
    E-->>U: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«

    Note over U,DB: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ
    U->>W: ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
    W->>DB: ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æ€§ç¢ºèª
    DB-->>W: ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹
    W-->>U: æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ç”»é¢
    U->>W: æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
    W->>W: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯
    W->>DB: æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜
    W->>DB: ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤
    W-->>U: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å®Œäº†
```

### ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£…ä¾‹

```typescript
// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆè¦æ±‚
const requestPasswordReset = async (email: string) => {
  try {
    // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼
    const sanitizedEmail = sanitizeString(email);
    if (!validateEmail(sanitizedEmail)) {
      return { error: 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' };
    }

    // Supabase ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
    const { data, error } = await supabase.auth.resetPasswordForEmail(sanitizedEmail, {
      redirectTo: `${window.location.origin}/auth/reset-password`
    });

    if (error) {
      return { error: error.message };
    }

    return { 
      data, 
      error: null,
      message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚'
    };
  } catch (error) {
    return { error: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' };
  }
};
```

## ğŸ¯ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

### âœ… è¦šãˆã¦ãŠãã¹ãã“ã¨

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯çµ¶å¯¾ã«å¹³æ–‡ä¿å­˜ã—ãªã„**: å¿…ãšãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜
2. **ã‚½ãƒ«ãƒˆã¯å¿…é ˆ**: ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã‚’é˜²ããŸã‚
3. **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¨å¥¨**: é•·ã• + è¤‡æ•°ã®æ–‡å­—ç¨®é¡
4. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¯å¿…é ˆ**: ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–
5. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½**: å®‰å…¨ãªå®Ÿè£…ãŒé‡è¦

### âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨

```typescript
// âŒ å±é™ºãªä¾‹
const badExamples = {
  // å¹³æ–‡ä¿å­˜
  password: "user_password_123",
  
  // å˜ç´”ãªãƒãƒƒã‚·ãƒ¥ï¼ˆã‚½ãƒ«ãƒˆãªã—ï¼‰
  passwordHash: md5("user_password_123"),
  
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
  console.log("User password:", password),
  
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’URLã«å«ã‚ã‚‹
  url: "/reset?password=newpassword123",
  
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’JavaScriptã§å¹³æ–‡å‡¦ç†
  localStorage.setItem("password", password)
};
```

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **bcrypt ã‚„ Argon2 ãªã©ã®å¼·åŠ›ãªãƒãƒƒã‚·ãƒ¥é–¢æ•°ã‚’ä½¿ç”¨**
2. **é©åˆ‡ãªã‚½ãƒ«ãƒˆé•·ï¼ˆæœ€ä½16ãƒã‚¤ãƒˆï¼‰**
3. **é©åˆ‡ãªãƒãƒƒã‚·ãƒ¥è¨ˆç®—ã‚³ã‚¹ãƒˆï¼ˆbcrypt ã®å ´åˆã¯10-12ï¼‰**
4. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å±¥æ­´ã®ç®¡ç†ï¼ˆéå»ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†åˆ©ç”¨é˜²æ­¢ï¼‰**
5. **å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»**

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¤ã„ã¦ç†è§£ã§ããŸã‚‰ã€æ¬¡ã¯ **[ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼](./login-flow.md)** ã§ã€èªè¨¼å‡¦ç†ã®å…¨ä½“çš„ãªæµã‚Œã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚

å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‹ã‚‰æŠ€è¡“çš„ãªå®Ÿè£…ã¾ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿ã‚’åŒ…æ‹¬çš„ã«ç†è§£ã§ãã¾ã™ã€‚